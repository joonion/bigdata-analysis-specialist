
<<init>>
```{r}
#install.packages("data.table")
library(data.table)
```
# 4. 생활속의 통계학 제 5 장, 제 6 장의 예제/연습문제를 R코드로 풀어보시오.


```{r}
# 1. 이산확률변수와 확률분포가 다음과 같을 때, NA를 치환하고 평균과 분산을 구하라.
replace_NA = function(prob){
  this_p = copy(prob)
  index_NA =which(is.na(this_p))
  this_p[index_NA] = 1-sum(this_p,na.rm=T)
  
  this_p
}

sum_of_dd = function(dd){
  sum(processed*x)
}

x = c(-2,-1,0,1,2)
p_x = c(0.15,0.25,NA,0.25,0.3)
processed = replace_NA(p_x)

# result
processed
sum_of_dd(processed)
var(x=x,y=processed)

```

```{r}
# 2. X~B(8,0.45) 일때 다음을 구하라.
? rbinom

n = 8
p = 0.45

#P(X=4)
dbinom(4,n,p)

# P(X!=3)
1 - dbinom(3,n,p)

# P(X<=5)
pbinom(5,n,p)

# P(X>=6)
pbinom(6,n,p,lower.tail = F) + dbinom(6,n,p)

# 평균
m = n*p
m

# 분산
v = n*p*(1-p)
v

# P(평균-표준편차<=X<=평균+표준편차)
1 - 2*pbinom(m-sqrt(v),n,p)

# P(평균-2표준편차<=X<=평균+2표준편차)
1 - 2*pbinom(m-2*sqrt(v),n,p)
```

```{r}
# 3. X~P(5) 에 대하여 다음 확률을 구하라
# np := 5
# n을 30 이상.. 200으로 두고 계산한다. 
# n = 200, p = 0.025

# P(X=3)
n = 200
p = 0.025
dbinom(3,n,p)

# P(X<=4)
pbinom(4,n,p)

# P(X>=10)
pbinom(10,n,p,lower.tail=F)+dbinom(10,n,p)

# P(4<=X<=8)
pbinom(8,n,p)-pbinom(4,n,p)+dbinom(4,n,p)
```
# 4. Chapter 5, 6 x2
# 5.30. 오염정도 19 심각, 6 약간, 5 - / 5곳 선정
```{r}
# 1. 오염 정도에 따른 확률 분포
knitr::opts_chunk$set(echo = TRUE) # ?

# 심각 x, 약간 y
q30 <- function(x, y) choose(19,x)*choose(6,y)*choose(5,5-x-y)/choose(30,5)


q30(5,0) # 심각 5
q30(4,0:1) # 심각 4 (약간 0:1)
q30(3,0:2) # 심각 3 (약간 0:2)
q30(2,0:3) # 심각 2 (약간 0:3)
q30(1,0:4) # 심각 1 (약간 0:4)
q30(0,0:5) # 심각 0 (약간 0:5)
```

```{r}
# 5.30.2 5중 심각3, 약간 1 확률
q30(3,1)
```

```{r}
# 5.30.3 5중 적어도 4곳이 심각
simgak4 <- 0
for (x in 4:5) {
  z=5-x
  for (y in 0:z) simgak4 <- simgak4+q30(x,y)
}

simgak4

# 아니라면
q30(5,0)+sum(q30(4,0:1))
```

# 5.29. 50개 상품 수입 중 5개에서 결함이 발생한다.
# 10개를 임의로 뽑아 결함조사 한다. 이때 결함상품 2개 이하면 수입 허용할 때, 수입 허용할 확률은?
```{r}
# 전체 경우 x = 결함 갯수
q29 <- function(x) choose(5,x)*choose(45,10-x)/choose(50,10)


# 확률 분포
q29(0:5)
# 2개 이하 일 확률 (Ans)
sum(q29(0:2))
```


# 6.26 T~t(n)에 대하여 분산=1.25.
# 이때 자유도n, P(|T| <= 2.228) 을 구하라.
```{r}
# 분산 = n/(n-2)
# n=10
# 1. P(|T|<=2.228) n=10
a <- pt(2.228, 10) # a = P(T<=2.228)
b <- 1-a # b = P(T>2.228)
1-2*b # P(|T|<=2.228)
```


# 6.25 2000명이 1년간 가입.
# 이 기간 중 개개인 사망률 0.001.
# 적어도 4건에 대해 보상해야할 근사확률

## 1. 푸아송 구간을 구하라.

```{r}
# 1. 푸아송
a <- ppois(q=3, lambda=2000*0.001) #0~3
1-a # answer (>=4)
```

## 2. 정규 근사
```{r}

# 2. 정규 근사
n <- 2000
p <- 0.001

1-pbinom(3,n,p) # 이항분포
sigma <- sqrt(n*p*(1-p))
1-pnorm(3.5,n*p,sigma) # 정규근사 3 -> 2.5~3.5 / 4 -> 3.5~4.5
```


# 생활속의 통계학 제 7 장, 제 8 장의 예제/연습문제 중에서 각각 2문제(총 4문제)를 골라 R 코드로 풀어보시오.


## 7.34.1 p1-p2 에 대한 근사 확률 표
```{r}
# 모비율 동일
n <- 131
m <- 48
p <- 0.93 # 모비율
a <- p*(1-p)/n
b <- p*(1-p)/m
c <- sqrt(a+b) # 표준편차

# N(0, a+b)
# Z = (p1-p2)/c
```

## 7.34.2. p1-p2 가 5% 보다 작을 근사 확률
```{r}
pnorm(0.05, 0, sd=c)

```

## 7.34.3. p1-p2 가 관찰된 표본비율의 차보다 클 근사확률
```{r}
1-pnorm(0.001, 0, sd=c) # 0.1% 보다 클
```

## 7.34.4. p1-p2가 p0보다 클 확률이 0.05인 p0
```{r}
-qnorm(0.05, 0, sd=c)
```

# 7.33. 모비율 남 37.8%, 여 25.4%
# 표본 남 500, 여 450 / 남녀 비율의 차가 10% 이하일 확률
```{r}
p1=0.378
p2=0.254

var1=p1*(1-p1)/500
var2=p2*(1-p2)/450

cha <- p1-p2

pnorm(0.1, cha, sd=sqrt(var1+var2))
## 
```

# 8.21. 모 일간지 선호도 구할 때, 95% 신뢰구간의 길이를 8% 이내로 구하기 위한 표본조사
# 다음과 같은 상황에서 조건을 만족시키는 최소한의 표본 크기를 구하라.
### 1. 5년전 조사에 따르면, 이 일간지의 선호도는 29.7%
```{r}
# 사전정보가 있는 경우
a <- qnorm(0.975) # 약 1.96
# 신뢰구간의 길이 0.08 -> 오차한계 0.04
d <- 0.08
# 5년전 선호도 29.7%
p=0.297
# n >= 4*a^2*p*(1-p)/d^2 # 사전정보가 있는 경우
n <- 4*a^2*p*(1-p)/d^2
n
```

### 2. 표본조사를 처음으로 실시하여 아무런 정보가 없는 경우
```{r}
# n >= a^2/d^2
a <- qnorm(0.975)
d <- 0.08
n <- a^2/d^2
n
```


# 8.20. 95% 신뢰구간의 길이가 0.4를 넘지 않도록 하기 위해# 소한의 표본 크기를 구하라.
# (염분 농도에 대한 표준편차는 3)
```{r}
# 95% 신뢰구간
a <- qnorm(0.975)
sigma <- 3
# 신뢰구간 길이 0.4 -> 오차한계 0.2
# 0.2 = a*sigma/sqrt(n)
n <- (a*sigma/0.2)^2
n
```


# 8.19. 남학생 256, 여학생 348 / 남 83.9%, 여 59.2%
# 음주율차 95% 신뢰구간
```{r}
p1 <- 0.839
p2 <- 0.592
n1 <- 256
n2 <- 348
mean19 <- p1-p2
mean19
var1 <- p1*(1-p1)/n1
var2 <- p2*(1-p2)/n2
var <- var1+var2
qq <- qnorm(0.975, mean=mean19, sd=sqrt(var))
qq
# 오차
e1 <- qq-mean19
e1
c(mean19-e1,mean19+e1)

```


